var F=Object.defineProperty;var q=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var p=(s,t,e)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,P=(s,t)=>{for(var e in t||(t={}))G.call(t,e)&&p(s,e,t[e]);if(q)for(var e of q(t))U.call(t,e)&&p(s,e,t[e]);return s};var c=(s,t,e)=>(p(s,typeof t!="symbol"?t+"":t,e),e);const W=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}};W();const d=(s,t)=>P({__type:s},t),C=(...s)=>t=>{s.forEach(e=>{e(t)})};class ${constructor(t){c(this,"entities");c(this,"components");c(this,"startupSystems");c(this,"systems");c(this,"nextId",0);c(this,"resources");c(this,"getEntities",()=>this.entities[Symbol.iterator]);c(this,"step",()=>{this.systems.forEach(t=>{t(this)}),requestAnimationFrame(this.step)});this.resources=t,this.entities=new Set,this.components=new Map,this.startupSystems=[],this.systems=[]}addEntity(...t){const e=this.nextId++;this.entities.add(e);for(const n of t)typeof n=="function"?this.addComponent(e,n(e,this)):this.addComponent(e,n);return e}addComponent(t,e){var o;const n=e.__type;return this.components.has(n)||this.components.set(n,new Map),(o=this.components.get(n))==null||o.set(t,e),this}removeComponent(t,e){var n;return(n=this.components.get(e))==null||n.delete(t),this}removeEntity(t){var e;for(const n of this.components.keys())(e=this.components.get(n))==null||e.delete(t);return this.entities.delete(t),this}getComponent(t,e){var n;return(n=this.components.get(e))==null?void 0:n.get(t)}hasComponent(t,e){var n,o;return(o=(n=this.components.get(e))==null?void 0:n.has(t))!=null?o:!1}addSystem(t){return this.systems.push(t),this}addStartupSystem(t){return this.startupSystems.push(t),this}*query(t,...e){var n,o;for(const i of(o=(n=this.components.get(t))==null?void 0:n.keys())!=null?o:[])if(e.every(r=>this.hasComponent(i,r))){const r=new Array(e.length+2);r[0]=this.getComponent(i,t),e.forEach((h,y)=>{r[y+1]=this.getComponent(i,h)}),e.forEach(h=>{r.push(this.getComponent(i,h))}),r[e.length+1]=i,yield r}}run(){return this.startupSystems.forEach(t=>{t(this)}),this.step(),this}}const H=s=>new $(s),K=d("active",{}),X=d("attractor",{});class Y{constructor(t,e){c(this,"x");c(this,"y");this.x=t,this.y=e}addMut({x:t,y:e}){return this.x+=t,this.y+=e,this}add({x:t,y:e}){return a(this.x+t,this.y+e)}subMut({x:t,y:e}){return this.x-=t,this.y-=e,this}sub({x:t,y:e}){return a(this.x-t,this.y-e)}timesMut(t){return this.x*=t,this.y*=t,this}times(t){return a(this.x*t,this.y*t)}divMut(t){return this.x/=t,this.y/=t,this}div(t){return a(this.x/t,this.y/t)}distSq({x:t,y:e}){return(t-this.x)**2+(e-this.y)**2}dist(t){return Math.sqrt(this.distSq(t))}length(){return Math.sqrt(this.lengthSq())}lengthSq(){return this.x**2+this.y**2}normalize(){return this.div(this.length())}normalizeMut(){return this.divMut(this.length()),this}copy({x:t,y:e}){return this.x=t,this.y=e,this}set(t,e){return this.x=t,this.y=e,this}clone(){return a(this.x,this.y)}dot({x:t,y:e}){return this.x*t+this.y*e}reflectMut(t){return this.subMut(t.times(2*this.dot(t)))}reflect(t){return this.sub(t.times(2*this.dot(t)))}limitMut(t){return this.lengthSq()>t*t?this.normalizeMut().timesMut(t):this}limit(t){return this.lengthSq()>t*t?this.normalize().times(t):this.clone()}}const a=(s,t)=>new Y(s,t),k=(s,t)=>d("gravity",{velocity:s,acceleration:t,prevPosition:a(1/0,1/0)}),g=s=>({__type:"mass",mass:s}),I=(s,t)=>{const e=t.getComponent(s,"shape");if(e===void 0)return g(0);switch(e.shape){case"circle":return g(e.radius**2*1e9);default:return g(0)}},E=s=>d("position",{position:s}),_=s=>d("shape",s),V=s=>d("target",{target:s}),j=(s,t)=>s+Math.random()*(s-t),S=(s,t)=>s+Math.floor(Math.random()*(t-s+1)),J=s=>s[Math.floor(Math.random()*s.length)],v=4,A=(s,t,e=v)=>{const n=j(0,2*Math.PI);return s.add(a(Math.cos(n),Math.sin(n)).times(t+e))},Q=(s=10)=>t=>{for(let e=0;e<s;e++){const n=a(S(0,window.innerWidth),S(0,window.innerHeight)),o=S(10,60),i=[E(n),_({shape:"circle",color:et(),radius:o}),I,X];e===s-1&&i.push(V(A(n,o,0))),t.addEntity(...i)}},Z=(s=1)=>t=>{const e=[...t.query("position","shape","attractor")];for(let n=0;n<s;n++){const[{position:o},{radius:i}]=J(e);t.addEntity(E(A(o,i)),_({shape:"circle",radius:v,color:O(255,255,255)}),I,k(a(0,0),a(0,0)))}},tt=s=>{const{canvas:t,action:e}=s.resources;t.addEventListener("pointerdown",n=>{e.start.set(n.clientX,n.clientY)}),t.addEventListener("pointermove",n=>{e.start.x<1/0&&e.end.set(n.clientX,n.clientY)}),t.addEventListener("pointerup",()=>{const n=e.start.sub(e.end).times(500).limit(1e5*.6);for(const[{acceleration:o},i]of s.query("gravity"))s.hasComponent(i,"active")||s.addComponent(i,K),o.addMut(n);e.start.set(1/0,1/0),e.end.set(1/0,1/0)})},T=2*Math.PI,L=v*2,O=(s,t,e)=>({r:s,g:t,b:e}),et=()=>O(Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)),st=({r:s,g:t,b:e})=>`rgb(${s}, ${t}, ${e})`,R="rgb(0, 13, 36)",nt=s=>{const{canvas:t,context:e}=s.resources;e.clearRect(0,0,s.resources.canvas.width,t.height),e.fillStyle=R,e.fillRect(0,0,t.width,t.height)},z=(s,t,e,n)=>{s.beginPath(),s.fillStyle=st(n),s.arc(t.x,t.y,e,0,T),s.closePath(),s.fill()},ot=s=>{for(const[{position:t},e]of s.query("position","shape","attractor"))e.shape==="circle"&&z(s.resources.context,t,e.radius,e.color)},it=s=>{for(const[{position:t},e]of s.query("position","shape","gravity"))e.shape==="circle"&&z(s.resources.context,t,e.radius,e.color)},rt=s=>{const{context:t,action:e}=s.resources;if(e.start.x<1/0){const n=e.start.sub(e.end).times(.5).limit(e.maxLength);for(const[{position:o}]of s.query("position","gravity"))t.beginPath(),t.strokeStyle="rgb(255, 255, 255)",t.moveTo(o.x,o.y),t.lineTo(o.x+n.x,o.y+n.y),t.closePath(),t.stroke()}},at=s=>{const{context:t}=s.resources;for(const[{target:e}]of s.query("target"))t.beginPath(),t.fillStyle=R,t.arc(e.x,e.y,L,0,T),t.closePath(),t.fill()},ct=C(nt,ot,at,it,rt),ht=(s,t,e,n)=>{const o=s.sub(e),i=1e-5*(n*t/o.lengthSq());return o.normalizeMut().timesMut(i)},B=1/60,dt=s=>{const t=s.query("active","gravity","position","mass"),e=[...s.query("attractor","position","mass")];for(const[n,{velocity:o,acceleration:i},{position:r},{mass:h}]of t){for(const[y,{position:M},{mass:l}]of e){const m=ht(M,l,r,h);i.addMut(m.div(h))}o.addMut(i.times(B)),r.addMut(o.times(B)),i.set(0,0)}},lt=s=>{const t=s.query("active","gravity","position","shape"),e=[...s.query("attractor","position","shape")];for(const[n,{velocity:o,prevPosition:i},{position:r},h,y]of t)for(const[M,{position:l},m,D]of e){const w=h.radius+m.radius;if(r.distSq(l)<=w**2){const x=r.sub(l).normalize(),b=l.add(x.times(w));o.reflectMut(x).timesMut(.8);const f=s.getComponent(D,"target");f&&f.target.distSq(r)<=L**2&&b.copy(f.target),r.copy(b),i.distSq(r)<.3&&s.removeComponent(y,"active");break}}},ut=C(dt,lt),u=document.createElement("canvas");u.width=window.innerWidth;u.height=window.innerHeight;const N=u.getContext("2d");if(N===null)throw"could not get canvas 2d context";const yt={canvas:u,context:N,action:{start:a(1/0,1/0),end:a(1/0,1/0),maxLength:150}};H(yt).addStartupSystem(Q(10)).addStartupSystem(Z(1)).addStartupSystem(tt).addSystem(ut).addSystem(ct).run();document.body.appendChild(u);
