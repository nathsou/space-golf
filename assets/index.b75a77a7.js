var O=Object.defineProperty;var k=(s,t,e)=>t in s?O(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>(k(s,typeof t!="symbol"?t+"":t,e),e);import{c as p,a as A}from"./vendor.594abaaa.js";const z=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}};z();class B{constructor(t,e){h(this,"x");h(this,"y");this.x=t,this.y=e}addMut({x:t,y:e}){return this.x+=t,this.y+=e,this}add({x:t,y:e}){return c(this.x+t,this.y+e)}subMut({x:t,y:e}){return this.x-=t,this.y-=e,this}sub({x:t,y:e}){return c(this.x-t,this.y-e)}timesMut(t){return this.x*=t,this.y*=t,this}times(t){return c(this.x*t,this.y*t)}divMut(t){return this.x/=t,this.y/=t,this}div(t){return c(this.x/t,this.y/t)}distSq({x:t,y:e}){return(t-this.x)**2+(e-this.y)**2}dist(t){return Math.sqrt(this.distSq(t))}length(){return Math.sqrt(this.lengthSq())}lengthSq(){return this.x**2+this.y**2}normalize(){return this.div(this.length())}normalizeMut(){return this.divMut(this.length()),this}copy({x:t,y:e}){return this.x=t,this.y=e,this}set(t,e){return this.x=t,this.y=e,this}clone(){return c(this.x,this.y)}dot({x:t,y:e}){return this.x*t+this.y*e}reflectMut(t){return this.subMut(t.times(2*this.dot(t)))}reflect(t){return this.sub(t.times(2*this.dot(t)))}limitMut(t){return this.lengthSq()>t*t?this.normalizeMut().timesMut(t):this}limit(t){return this.lengthSq()>t*t?this.normalize().timesMut(t):this.clone()}}const c=(s,t)=>new B(s,t),R=(s,t)=>s+Math.random()*(s-t),l=(s,t)=>s+Math.floor(Math.random()*(t-s+1)),D=s=>s[Math.floor(Math.random()*s.length)],I=(s,t,e=y*2)=>s.center.distSq(t.center)<=(s.radius+t.radius+e)**2,F=(s,t,e,n,o,r)=>{const i={retry:()=>{const a={center:c(l(0,n),l(0,o)),radius:l(t,e)};return s.some(d=>I(a,d))?i.retry():a},shrink:()=>{const a={center:c(l(0,n),l(0,o)),radius:l(t,e)};for(;s.some(d=>I(a,d))&&a.radius>=t;)a.radius-=1;return a.radius<t?i.shrink():a}};return i[r]()},G=(s,t,e,n,o,r)=>{const i=[];for(let a=0;a<s;a++)i.push(F(i,t,e,n,o,r));return i},y=6,q=s=>s**2*1e9,w=(s,t,e=y)=>{const n=R(0,2*Math.PI);return s.add(c(Math.cos(n),Math.sin(n)).times(t+e))},U=(s=10)=>t=>{G(s,20,60,window.innerWidth,window.innerHeight,"shrink").forEach(({center:e,radius:n},o)=>{const r=t.addEntity([{type:"body",position:e,mass:q(n)},{type:"shape",kind:"circle",color:H(),radius:n},{type:"attractor"}]);o===s-1&&r.add({type:"target",target:w(e,n,0)})})},W=(s=1)=>t=>{const e=t.query("body","shape","attractor");for(let n=0;n<s;n++){const[{position:o},{radius:r}]=D(e);t.addEntity([{type:"body",position:w(o,r),mass:q(y)},{type:"movement",acceleration:c(0,0),velocity:c(0,0),prevPosition:c(1/0,1/0)},{type:"shape",kind:"circle",radius:y,color:E(255,255,255)}])}},$=s=>{const{canvas:t,action:e}=s.resources;t.addEventListener("pointerdown",n=>{e.start.set(n.clientX,n.clientY)}),t.addEventListener("pointermove",n=>{e.start.x<1/0&&e.end.set(n.clientX,n.clientY)}),t.addEventListener("pointerup",()=>{const n=e.start.sub(e.end).times(500).limit(1e5*.6);if(!isNaN(n.x)&&!isNaN(n.y))for(const[{acceleration:o},r]of s.queryIter("movement"))s.hasComponent(r,"active")||s.addComponent(r,{type:"active"}),o.addMut(n);e.start.set(1/0,1/0),e.end.set(1/0,1/0)})},P=2*Math.PI,C=y*2,E=(s,t,e)=>({r:s,g:t,b:e}),H=()=>E(Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)),K=({r:s,g:t,b:e})=>`rgb(${s}, ${t}, ${e})`,L="rgb(9, 7, 56)",X=s=>{const{canvas:t,context:e}=s.resources;e.clearRect(0,0,s.resources.canvas.width,t.height),e.fillStyle=L,e.fillRect(0,0,t.width,t.height)},T=(s,t,e,n)=>{s.beginPath(),s.fillStyle=K(n),s.arc(t.x,t.y,e,0,P),s.closePath(),s.fill()},Y=s=>{for(const[{position:t},e]of s.queryIter("body","shape","attractor"))e.kind==="circle"&&T(s.resources.context,t,e.radius,e.color)},j=s=>{for(const[{position:t},e]of s.queryIter("body","shape","movement"))e.kind==="circle"&&T(s.resources.context,t,e.radius,e.color)},V=s=>{const{context:t,action:e}=s.resources;if(e.start.x<1/0){const n=e.start.sub(e.end).times(.5).limit(e.maxLength);for(const[o,{position:r}]of s.queryIter("movement","body"))t.beginPath(),t.strokeStyle="rgb(255, 255, 255)",t.moveTo(r.x,r.y),t.lineTo(r.x+n.x,r.y+n.y),t.closePath(),t.stroke()}},J=s=>{const{context:t}=s.resources;for(const[{target:e}]of s.queryIter("target"))t.beginPath(),t.fillStyle=L,t.arc(e.x,e.y,C,0,P),t.closePath(),t.fill()},Q=p(X,Y,J,j,V),Z=(s,t,e,n)=>{const o=s.sub(e),r=1e-5*(n*t/o.lengthSq());return o.normalizeMut().timesMut(r)},N=1/60,tt=s=>{const t=s.queryIter("active","movement","body"),e=s.query("attractor","body");for(const[n,{velocity:o,acceleration:r},{position:i,mass:a}]of t){for(const[d,{position:M,mass:u}]of e){const m=Z(M,u,i,a);r.addMut(m.div(a))}o.addMut(r.times(N)),i.addMut(o.times(N)),r.set(0,0)}},et=s=>{const t=s.queryIter("active","movement","body","shape"),e=s.query("attractor","body","shape");for(const[n,{velocity:o,prevPosition:r},{position:i},a,d]of t)for(const[M,{position:u},m,_]of e){const b=a.radius+m.radius;if(i.distSq(u)<=b**2){const S=i.sub(u).normalize(),x=u.add(S.times(b));o.reflectMut(S).timesMut(.8);const f=s.getComponent(_,"target");f&&f.target.distSq(i)<=C**2&&(x.copy(f.target),s.resources.game.nextLevel()),i.copy(x),r.distSq(i)<.3&&s.removeComponent(d,"active");break}}},v=p(tt,et);class st{constructor(){h(this,"app");h(this,"canvas");const t=document.createElement("canvas");this.canvas=t,t.width=window.innerWidth,t.height=window.innerHeight;const e=t.getContext("2d");if(e===null)throw"could not get canvas 2d context";this.app=A({canvas:t,context:e,action:{start:c(1/0,1/0),end:c(1/0,1/0),maxLength:150},camera:{offset:c(0,0)},game:this}).addStartupSystem($).addSystem(v).addSystem(Q)}nextLevel(t=!1){const e=p(U(l(2,10)),W(1));this.app.removeSystem(v),setTimeout(()=>{this.app.query("body").forEach(([n,o])=>{this.app.removeEntity(o)}),e(this.app),this.app.addSystem(v)},t?0:1e3)}run(){this.app.run()}}const g=new st;g.nextLevel(!0);g.run();document.body.appendChild(g.canvas);
