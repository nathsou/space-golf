var U=Object.defineProperty;var P=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var f=(s,t,e)=>t in s?U(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,q=(s,t)=>{for(var e in t||(t={}))D.call(t,e)&&f(s,e,t[e]);if(P)for(var e of P(t))F.call(t,e)&&f(s,e,t[e]);return s};var c=(s,t,e)=>(f(s,typeof t!="symbol"?t+"":t,e),e);const G=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}};G();const h=(s,t)=>q({__type:s},t);class W{constructor(t){c(this,"entities");c(this,"components");c(this,"startupSystems");c(this,"systems");c(this,"nextId",0);c(this,"resources");c(this,"step",()=>{this.systems.forEach(t=>{t(this)}),requestAnimationFrame(this.step)});this.resources=t,this.entities=new Set,this.components=new Map,this.startupSystems=[],this.systems=[]}addEntity(...t){const e=this.nextId++;this.entities.add(e);for(const n of t)typeof n=="function"?this.addComponent(e,n(e,this)):this.addComponent(e,n);return e}addComponent(t,e){var o;const n=e.__type;return this.components.has(n)||this.components.set(n,new Map),(o=this.components.get(n))==null||o.set(t,e),this}removeComponent(t,e){var n;return(n=this.components.get(e))==null||n.delete(t),this}removeEntity(t){var e;for(const n of this.components.keys())(e=this.components.get(n))==null||e.delete(t);return this.entities.delete(t),this}getComponent(t,e){var n;return(n=this.components.get(e))==null?void 0:n.get(t)}hasComponent(t,e){var n,o;return(o=(n=this.components.get(e))==null?void 0:n.has(t))!=null?o:!1}addSystem(t){return this.systems.push(t),this}addStartupSystem(t){return this.startupSystems.push(t),this}*query(...t){for(const e of this.entities)if(t.every(n=>{var o;return(o=this.components.get(n))==null?void 0:o.has(e)})){const n=t.map(o=>{var i;return(i=this.components.get(o))==null?void 0:i.get(e)});n.push(e),yield n}}run(){return this.startupSystems.forEach(t=>{t(this)}),this.step(),this}}const $=s=>new W(s),H=h("active",{}),K=h("attractor",{});class X{constructor(t,e){c(this,"x");c(this,"y");this.x=t,this.y=e}addMut({x:t,y:e}){this.x+=t,this.y+=e}add({x:t,y:e}){return a(this.x+t,this.y+e)}subMut({x:t,y:e}){this.x-=t,this.y-=e}sub({x:t,y:e}){return a(this.x-t,this.y-e)}timesMut(t){this.x*=t,this.y*=t}times(t){return a(this.x*t,this.y*t)}divMut(t){this.x/=t,this.y/=t}div(t){return a(this.x/t,this.y/t)}distSq({x:t,y:e}){return(t-this.x)**2+(e-this.y)**2}dist(t){return Math.sqrt(this.distSq(t))}length(){return Math.sqrt(this.lengthSq())}lengthSq(){return this.x**2+this.y**2}normalize(){return this.div(this.length())}normalizeMut(){this.divMut(this.length())}copy({x:t,y:e}){this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}clone(){return a(this.x,this.y)}dot({x:t,y:e}){return this.x*t+this.y*e}reflect(t){return this.sub(t.times(2*this.dot(t)))}limit(t){return this.lengthSq()>t*t?this.normalize().times(t):this.clone()}}const a=(s,t)=>new X(s,t),Y=(s,t)=>h("gravity",{velocity:s,acceleration:t,prevPosition:a(1/0,1/0)}),p=s=>({__type:"mass",mass:s}),I=(s,t)=>{const e=t.getComponent(s,"shape");if(e===void 0)return p(0);switch(e.shape){case"circle":return p(e.radius**2*1e9);default:return p(0)}},C=s=>h("position",{position:s}),E=s=>h("shape",s),V=s=>h("target",{target:s}),j=(s,t)=>s+Math.random()*(s-t),g=(s,t)=>s+Math.floor(Math.random()*(t-s+1)),k=s=>s[Math.floor(Math.random()*s.length)],S=4,_=(s,t,e=S)=>{const n=j(0,2*Math.PI);return s.add(a(Math.cos(n),Math.sin(n)).times(t+e))},J=(s=10)=>t=>{for(let e=0;e<s;e++){const n=a(g(0,window.innerWidth),g(0,window.innerHeight)),o=g(10,60),i=[C(n),E({shape:"circle",color:tt(),radius:o}),I,K];e===s-1&&i.push(V(_(n,o,0))),t.addEntity(...i)}},Q=(s=1)=>t=>{const e=[...t.query("position","shape","attractor")];for(let n=0;n<s;n++){const[{position:o},{radius:i}]=k(e);t.addEntity(C(_(o,i)),E({shape:"circle",radius:S,color:T(255,255,255)}),I,Y(a(0,0),a(0,0)))}},Z=s=>{const{canvas:t,action:e}=s.resources;t.addEventListener("pointerdown",n=>{e.start.set(n.clientX,n.clientY)}),t.addEventListener("pointermove",n=>{e.start.x<1/0&&e.end.set(n.clientX,n.clientY)}),t.addEventListener("pointerup",()=>{const n=e.start.sub(e.end).times(500).limit(1e5*.6);for(const[{acceleration:o},i]of s.query("gravity"))s.hasComponent(i,"active")||s.addComponent(i,H),o.addMut(n);e.start.set(1/0,1/0),e.end.set(1/0,1/0)})},A=2*Math.PI,L=S*2,T=(s,t,e)=>({r:s,g:t,b:e}),tt=()=>T(Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)),et=({r:s,g:t,b:e})=>`rgb(${s}, ${t}, ${e})`,O="rgb(0, 13, 36)",st=s=>{nt(s),ot(s),at(s),it(s),rt(s)},nt=s=>{const{canvas:t,context:e}=s.resources;e.clearRect(0,0,s.resources.canvas.width,t.height),e.fillStyle=O,e.fillRect(0,0,t.width,t.height)},R=(s,t,e,n)=>{s.beginPath(),s.fillStyle=et(n),s.arc(t.x,t.y,e,0,A),s.closePath(),s.fill()},ot=s=>{for(const[{position:t},e]of s.query("position","shape","attractor"))e.shape==="circle"&&R(s.resources.context,t,e.radius,e.color)},it=s=>{for(const[{position:t},e]of s.query("position","shape","gravity"))e.shape==="circle"&&R(s.resources.context,t,e.radius,e.color)},rt=s=>{const{context:t,action:e}=s.resources;if(e.start.x<1/0){const n=e.start.sub(e.end).times(.5).limit(e.maxLength);for(const[{position:o}]of s.query("position","gravity"))t.beginPath(),t.strokeStyle="rgb(255, 255, 255)",t.moveTo(o.x,o.y),t.lineTo(o.x+n.x,o.y+n.y),t.closePath(),t.stroke()}},at=s=>{const{context:t}=s.resources;for(const[{target:e}]of s.query("target"))t.beginPath(),t.fillStyle=O,t.arc(e.x,e.y,L,0,A),t.closePath(),t.fill()},ct=(s,t,e,n)=>{const o=s.sub(e),i=1e-5*(n*t/o.lengthSq());return o.normalize().times(i)},B=1/60,ht=s=>{const t=s.query("active","gravity","position","mass"),e=[...s.query("attractor","position","mass")];for(const[n,{velocity:o,acceleration:i},{position:r},{mass:u}]of t){for(const[v,{position:w},{mass:d}]of e){const y=ct(w,d,r,u);i.addMut(y.div(u))}o.addMut(i.times(B)),r.addMut(o.times(B)),i.set(0,0)}},dt=s=>{const t=s.query("active","gravity","position","shape"),e=[...s.query("attractor","position","shape")];for(const[n,{velocity:o,prevPosition:i},{position:r},u,v]of t)for(const[w,{position:d},y,z]of e){const M=u.radius+y.radius;if(r.distSq(d)<=M**2){const x=r.sub(d).normalize(),b=d.add(x.times(M));o.copy(o.reflect(x).times(.8));const m=s.getComponent(z,"target");m&&m.target.distSq(r)<=L**2&&b.copy(m.target),r.copy(b),i.distSq(r)<.3&&s.removeComponent(v,"active");break}}},l=document.createElement("canvas");l.width=window.innerWidth;l.height=window.innerHeight;const N=l.getContext("2d");if(N===null)throw"could not get canvas 2d context";const lt={canvas:l,context:N,action:{start:a(1/0,1/0),end:a(1/0,1/0),maxLength:150}};$(lt).addStartupSystem(J(5)).addStartupSystem(Q(1)).addStartupSystem(Z).addSystem(st).addSystem(ht).addSystem(dt).run();document.body.appendChild(l);
