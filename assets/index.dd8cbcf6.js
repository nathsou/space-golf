var F=Object.defineProperty;var b=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var p=(s,t,e)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,q=(s,t)=>{for(var e in t||(t={}))G.call(t,e)&&p(s,e,t[e]);if(b)for(var e of b(t))Q.call(t,e)&&p(s,e,t[e]);return s};var h=(s,t,e)=>(p(s,typeof t!="symbol"?t+"":t,e),e);const U=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}};U();const l=(s,t)=>q({__type:s},t),P=(...s)=>t=>{s.forEach(e=>{e(t)})};class W{constructor(t){h(this,"entities");h(this,"components");h(this,"startupSystems");h(this,"systems");h(this,"nextId",0);h(this,"resources");h(this,"getEntities",()=>this.entities[Symbol.iterator]);h(this,"step",()=>{for(let t=0;t<this.systems.length;t++)this.systems[t](this);requestAnimationFrame(this.step)});this.resources=t,this.entities=new Set,this.components=new Map,this.startupSystems=[],this.systems=[]}addEntity(...t){const e=this.nextId++;this.entities.add(e);for(const n of t)typeof n=="function"?this.addComponent(e,n(e,this)):this.addComponent(e,n);return e}addComponent(t,e){var o;const n=e.__type;return this.components.has(n)||this.components.set(n,new Map),(o=this.components.get(n))==null||o.set(t,e),this}removeComponent(t,e){var n;return(n=this.components.get(e))==null||n.delete(t),this}removeEntity(t){var e;for(const n of this.components.keys())(e=this.components.get(n))==null||e.delete(t);return this.entities.delete(t),this}getComponent(t,e){var n;return(n=this.components.get(e))==null?void 0:n.get(t)}hasComponent(t,e){var n,o;return(o=(n=this.components.get(e))==null?void 0:n.has(t))!=null?o:!1}addSystem(t){return this.systems.push(t),this}addStartupSystem(t){return this.startupSystems.push(t),this}storeQueryTuple(t,e,n,o){o[0]=this.getComponent(n,t);for(let i=0;i<e.length;i++){const r=e[i];o[i+1]=this.getComponent(n,r)}o[e.length+1]=n}query(t,...e){var o,i;const n=[];for(const r of(i=(o=this.components.get(t))==null?void 0:o.keys())!=null?i:[])if(e.every(c=>this.hasComponent(r,c))){const c=new Array(e.length+2);this.storeQueryTuple(t,e,r,c),n.push(c)}return n}*queryIter(t,...e){var o,i;const n=new Array(e.length+2);for(const r of(i=(o=this.components.get(t))==null?void 0:o.keys())!=null?i:[])e.every(c=>this.hasComponent(r,c))&&(this.storeQueryTuple(t,e,r,n),yield n)}run(){return this.startupSystems.forEach(t=>{t(this)}),this.step(),this}}const $=s=>new W(s),k=l("active",{}),H=l("attractor",{});class K{constructor(t,e){h(this,"x");h(this,"y");this.x=t,this.y=e}addMut({x:t,y:e}){return this.x+=t,this.y+=e,this}add({x:t,y:e}){return a(this.x+t,this.y+e)}subMut({x:t,y:e}){return this.x-=t,this.y-=e,this}sub({x:t,y:e}){return a(this.x-t,this.y-e)}timesMut(t){return this.x*=t,this.y*=t,this}times(t){return a(this.x*t,this.y*t)}divMut(t){return this.x/=t,this.y/=t,this}div(t){return a(this.x/t,this.y/t)}distSq({x:t,y:e}){return(t-this.x)**2+(e-this.y)**2}dist(t){return Math.sqrt(this.distSq(t))}length(){return Math.sqrt(this.lengthSq())}lengthSq(){return this.x**2+this.y**2}normalize(){return this.div(this.length())}normalizeMut(){return this.divMut(this.length()),this}copy({x:t,y:e}){return this.x=t,this.y=e,this}set(t,e){return this.x=t,this.y=e,this}clone(){return a(this.x,this.y)}dot({x:t,y:e}){return this.x*t+this.y*e}reflectMut(t){return this.subMut(t.times(2*this.dot(t)))}reflect(t){return this.sub(t.times(2*this.dot(t)))}limitMut(t){return this.lengthSq()>t*t?this.normalizeMut().timesMut(t):this}limit(t){return this.lengthSq()>t*t?this.normalize().times(t):this.clone()}}const a=(s,t)=>new K(s,t),X=(s,t)=>l("gravity",{velocity:s,acceleration:t,prevPosition:a(1/0,1/0)}),f=s=>({__type:"mass",mass:s}),C=(s,t)=>{const e=t.getComponent(s,"shape");if(e===void 0)return f(0);switch(e.shape){case"circle":return f(e.radius**2*1e9);default:return f(0)}},E=s=>l("position",{position:s}),_=s=>l("shape",s),Y=s=>l("target",{target:s}),V=(s,t)=>s+Math.random()*(s-t),g=(s,t)=>s+Math.floor(Math.random()*(t-s+1)),j=s=>s[Math.floor(Math.random()*s.length)],S=4,T=(s,t,e=S)=>{const n=V(0,2*Math.PI);return s.add(a(Math.cos(n),Math.sin(n)).times(t+e))},J=(s=10)=>t=>{for(let e=0;e<s;e++){const n=a(g(0,window.innerWidth),g(0,window.innerHeight)),o=g(10,60),i=[E(n),_({shape:"circle",color:et(),radius:o}),C,H];e===s-1&&i.push(Y(T(n,o,0))),t.addEntity(...i)}},Z=(s=1)=>t=>{const e=t.query("position","shape","attractor");for(let n=0;n<s;n++){const[{position:o},{radius:i}]=j(e);t.addEntity(E(T(o,i)),_({shape:"circle",radius:S,color:L(255,255,255)}),C,X(a(0,0),a(0,0)))}},tt=s=>{const{canvas:t,action:e}=s.resources;t.addEventListener("pointerdown",n=>{e.start.set(n.clientX,n.clientY)}),t.addEventListener("pointermove",n=>{e.start.x<1/0&&e.end.set(n.clientX,n.clientY)}),t.addEventListener("pointerup",()=>{const n=e.start.sub(e.end).times(500).limit(1e5*.6);if(!isNaN(n.x)&&!isNaN(n.y))for(const[{acceleration:o},i]of s.queryIter("gravity"))s.hasComponent(i,"active")||s.addComponent(i,k),o.addMut(n);e.start.set(1/0,1/0),e.end.set(1/0,1/0)})},A=2*Math.PI,N=S*2,L=(s,t,e)=>({r:s,g:t,b:e}),et=()=>L(Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)),st=({r:s,g:t,b:e})=>`rgb(${s}, ${t}, ${e})`,O="rgb(0, 13, 36)",nt=s=>{const{canvas:t,context:e}=s.resources;e.clearRect(0,0,s.resources.canvas.width,t.height),e.fillStyle=O,e.fillRect(0,0,t.width,t.height)},R=(s,t,e,n)=>{s.beginPath(),s.fillStyle=st(n),s.arc(t.x,t.y,e,0,A),s.closePath(),s.fill()},ot=s=>{for(const[{position:t},e]of s.queryIter("position","shape","attractor"))e.shape==="circle"&&R(s.resources.context,t,e.radius,e.color)},it=s=>{for(const[{position:t},e]of s.queryIter("position","shape","gravity"))e.shape==="circle"&&R(s.resources.context,t,e.radius,e.color)},rt=s=>{const{context:t,action:e}=s.resources;if(e.start.x<1/0){const n=e.start.sub(e.end).times(.5).limit(e.maxLength);for(const[{position:o}]of s.queryIter("position","gravity"))t.beginPath(),t.strokeStyle="rgb(255, 255, 255)",t.moveTo(o.x,o.y),t.lineTo(o.x+n.x,o.y+n.y),t.closePath(),t.stroke()}},at=s=>{const{context:t}=s.resources;for(const[{target:e}]of s.queryIter("target"))t.beginPath(),t.fillStyle=O,t.arc(e.x,e.y,N,0,A),t.closePath(),t.fill()},ct=P(nt,ot,at,it,rt),ht=(s,t,e,n)=>{const o=s.sub(e),i=1e-5*(n*t/o.lengthSq());return o.normalizeMut().timesMut(i)},z=1/60,lt=s=>{const t=s.queryIter("active","gravity","position","mass"),e=s.query("attractor","position","mass");for(const[n,{velocity:o,acceleration:i},{position:r},{mass:c}]of t){for(const[v,{position:M},{mass:u}]of e){const y=ht(M,u,r,c);i.addMut(y.div(c))}o.addMut(i.times(z)),r.addMut(o.times(z)),i.set(0,0)}},ut=s=>{const t=s.queryIter("active","gravity","position","shape"),e=s.query("attractor","position","shape");for(const[n,{velocity:o,prevPosition:i},{position:r},c,v]of t)for(const[M,{position:u},y,D]of e){const w=c.radius+y.radius;if(r.distSq(u)<=w**2){const x=r.sub(u).normalize(),I=u.add(x.times(w));o.reflectMut(x).timesMut(.8);const m=s.getComponent(D,"target");m&&m.target.distSq(r)<=N**2&&I.copy(m.target),r.copy(I),i.distSq(r)<.3&&s.removeComponent(v,"active");break}}},dt=P(lt,ut),d=document.createElement("canvas");d.width=window.innerWidth;d.height=window.innerHeight;const B=d.getContext("2d");if(B===null)throw"could not get canvas 2d context";const yt={canvas:d,context:B,action:{start:a(1/0,1/0),end:a(1/0,1/0),maxLength:150}};$(yt).addStartupSystem(J(10)).addStartupSystem(Z(1)).addStartupSystem(tt).addSystem(dt).addSystem(ct).run();document.body.appendChild(d);
